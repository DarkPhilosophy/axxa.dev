<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AXXA SQL Cluster Status</title>
  <style>
    :root{--bg:#0d1324;--panel:#141c34;--line:#2a355c;--text:#ecf1ff;--muted:#9eabd2;--ok:#22c55e;--warn:#f59e0b;--bad:#ef4444}
    *{box-sizing:border-box}body{margin:0;font-family:system-ui,Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,#0b1020,#0d1324);color:var(--text)}
    .wrap{max-width:1050px;margin:0 auto;padding:22px}.sub{color:var(--muted);margin-top:0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700}
    .healthy{background:rgba(34,197,94,.18);color:#86efac}.degraded{background:rgba(245,158,11,.18);color:#fcd34d}.danger{background:rgba(239,68,68,.18);color:#fca5a5}
    code{background:#0b1020;border:1px solid var(--line);padding:2px 6px;border-radius:6px}
  </style>
  <link rel="icon" type="image/png" href="https://sql.axxa.dev/favicon.png" />
  <link rel="shortcut icon" href="https://sql.axxa.dev/favicon.ico" />
</head>
<body>
  <main class="wrap">
    <h1>AXXA SQL Cluster Status</h1>
    <p class="sub">Live source: <code>https://sql.axxa.dev/status.json</code></p>
    <section class="grid">
      <article class="card">
        <h2>Overall</h2>
        <div id="overall" class="badge">Loading</div>
        <p id="primary">Primary: -</p>
        <p id="updated">Updated: -</p>
      </article>
      <article class="card">
        <h2>ATVPS</h2>
        <p id="a_mode"></p><p id="a_sqld"></p><p id="a_agent"></p><p id="a_port"></p><p id="a_ns"></p><p id="a_uptime"></p>
      </article>
      <article class="card">
        <h2>CloudVPS</h2>
        <p id="c_reach"></p><p id="c_mode"></p><p id="c_sqld"></p><p id="c_agent"></p><p id="c_port"></p><p id="c_ns"></p><p id="c_uptime"></p>
      </article>
    </section>
  </main>
  <script>
    function fmt(sec){sec=Number(sec||0);const d=Math.floor(sec/86400),h=Math.floor((sec%86400)/3600),m=Math.floor((sec%3600)/60);return `${d}d ${h}h ${m}m`}
    async function load(){
      try{
        const r=await fetch('https://sql.axxa.dev/status.json',{cache:'no-store'}),j=await r.json();
        const a=j.nodes.ATVPS,c=j.nodes.CloudVPS;
        const b=document.getElementById('overall');b.textContent=String(j.overall).toUpperCase();b.className='badge '+j.overall;
        document.getElementById('primary').textContent='Primary: '+j.primary_node;
        document.getElementById('updated').textContent='Updated: '+j.updated_at_utc;
        document.getElementById('a_mode').textContent='Mode: '+a.mode;
        document.getElementById('a_sqld').textContent='sqld: '+a.sqld_active;
        document.getElementById('a_agent').textContent='agent: '+a.agent_active;
        document.getElementById('a_port').textContent='19001: '+(a.primary_port_19001?'open (primary)':'closed');
        document.getElementById('a_ns').textContent='Namespaces: '+a.namespaces;
        document.getElementById('a_uptime').textContent='Uptime: '+fmt(a.sqld_uptime_sec);
        document.getElementById('c_reach').textContent='Reachable: '+c.reachable;
        document.getElementById('c_mode').textContent='Mode: '+c.mode;
        document.getElementById('c_sqld').textContent='sqld: '+c.sqld_active;
        document.getElementById('c_agent').textContent='agent: '+c.agent_active;
        document.getElementById('c_port').textContent='19001: '+(c.primary_port_19001?'open (primary)':'closed');
        document.getElementById('c_ns').textContent='Namespaces: '+c.namespaces;
        document.getElementById('c_uptime').textContent='Uptime: '+fmt(c.sqld_uptime_sec);
      }catch(e){const b=document.getElementById('overall');b.textContent='UNAVAILABLE';b.className='badge danger';}
    }
    load();setInterval(load,10000);
  </script>
</body>
</html>
