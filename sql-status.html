<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AXXA SQL Cluster Status</title>
  <style>
    @font-face {
      font-family: "Quicksand";
      font-style: normal;
      font-weight: 300;
      src: url(https://crearts-community.github.io/Assets/fonts/quicksand/quicksand-300.woff2) format("woff2");
    }
    @font-face {
      font-family: "Quicksand";
      font-style: normal;
      font-weight: 400;
      src: url(https://crearts-community.github.io/Assets/fonts/quicksand/quicksand-400.woff2) format("woff2");
    }
    @font-face {
      font-family: "Quicksand";
      font-style: normal;
      font-weight: 500;
      src: url(https://crearts-community.github.io/Assets/fonts/quicksand/quicksand-500.woff2) format("woff2");
    }
    @font-face {
      font-family: "Quicksand";
      font-style: normal;
      font-weight: 600;
      src: url(https://crearts-community.github.io/Assets/fonts/quicksand/quicksand-600.woff2) format("woff2");
    }
    @font-face {
      font-family: "Quicksand";
      font-style: normal;
      font-weight: 700;
      src: url(https://crearts-community.github.io/Assets/fonts/quicksand/quicksand-700.woff2) format("woff2");
    }

    :root{--bg:#0f172a;--panel:#172554;--line:#1d4ed8;--text:#eaf1ff;--muted:#b6c7ef;--ok:#22c55e;--warn:#f59e0b;--bad:#ef4444}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{font-family:'Quicksand',sans-serif;background:var(--bg);color:var(--text)}
    .wrap{width:100%;max-width:none;padding:18px}
    h1{margin:0 0 8px}
    .sub{color:var(--muted);margin-top:0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-weight:700}
    .healthy{background:rgba(34,197,94,.18);color:#86efac}.degraded{background:rgba(245,158,11,.18);color:#fcd34d}.danger{background:rgba(239,68,68,.18);color:#fca5a5}
    code{font-family:'Consolas',monospace;background:#0b1220;border:1px solid var(--line);padding:2px 6px;border-radius:6px}
    a{color:#93c5fd}
    .chart-wrap{margin-top:12px}
    canvas{width:100%;height:220px;background:#0b1220;border:1px solid var(--line);border-radius:10px}
    .legend{font-size:13px;color:var(--muted);margin-top:8px}
  </style>
  <link rel="icon" type="image/svg+xml" href="https://sql.axxa.dev/favicon.svg?v=4" />
</head>
<body>
  <main class="wrap">
    <h1>AXXA SQL Cluster Status</h1>
    <p class="sub">Live source: <code><a id="sourceLink" href="https://sql.axxa.dev/status.json" target="_blank" rel="noopener noreferrer">https://sql.axxa.dev/status.json</a></code></p>
    <section class="grid">
      <article class="card">
        <h2>Overall</h2>
        <div id="overall" class="badge">Loading</div>
        <p id="primary">Primary: -</p>
        <p id="updated">Updated: -</p>
      </article>
      <article class="card">
        <h2>ATVPS</h2>
        <p id="a_mode"></p><p id="a_sqld"></p><p id="a_agent"></p><p id="a_port"></p><p id="a_ns"></p><p id="a_uptime"></p>
      </article>
      <article class="card">
        <h2>CloudVPS</h2>
        <p id="c_reach"></p><p id="c_mode"></p><p id="c_sqld"></p><p id="c_agent"></p><p id="c_port"></p><p id="c_ns"></p><p id="c_uptime"></p>
      </article>
    </section>

    <section class="card chart-wrap">
      <h2>Health Timeline</h2>
      <canvas id="healthChart" width="980" height="220"></canvas>
      <div class="legend">Green = healthy, Yellow = degraded, Red = danger</div>
    </section>
  </main>
  <script>
    function fmt(sec){sec=Number(sec||0);const d=Math.floor(sec/86400),h=Math.floor((sec%86400)/3600),m=Math.floor((sec%3600)/60);return `${d}d ${h}h ${m}m`}
    async function load(){
      try{
        const r=await fetch('https://sql.axxa.dev/status.json',{cache:'no-store'}),j=await r.json();
        const a=j.nodes.ATVPS,c=j.nodes.CloudVPS;
        const b=document.getElementById('overall');b.textContent=String(j.overall).toUpperCase();b.className='badge '+j.overall;
        document.getElementById('primary').textContent='Primary: '+j.primary_node;
        document.getElementById('updated').textContent='Updated: '+j.updated_at_utc;
        document.getElementById('a_mode').textContent='Mode: '+a.mode;
        document.getElementById('a_sqld').textContent='sqld: '+a.sqld_active;
        document.getElementById('a_agent').textContent='agent: '+a.agent_active;
        document.getElementById('a_port').textContent='19001: '+(a.primary_port_19001?'open (primary)':'closed');
        document.getElementById('a_ns').textContent='Namespaces: '+a.namespaces;
        document.getElementById('a_uptime').textContent='Uptime: '+fmt(a.sqld_uptime_sec);
        document.getElementById('c_reach').textContent='Reachable: '+c.reachable;
        document.getElementById('c_mode').textContent='Mode: '+c.mode;
        document.getElementById('c_sqld').textContent='sqld: '+c.sqld_active;
        document.getElementById('c_agent').textContent='agent: '+c.agent_active;
        document.getElementById('c_port').textContent='19001: '+(c.primary_port_19001?'open (primary)':'closed');
        document.getElementById('c_ns').textContent='Namespaces: '+c.namespaces;
        document.getElementById('c_uptime').textContent='Uptime: '+fmt(c.sqld_uptime_sec);
      }catch(e){const b=document.getElementById('overall');b.textContent='UNAVAILABLE';b.className='badge danger';}
    }
    async function drawHistory(){
      const c=document.getElementById('healthChart');if(!c)return;const ctx=c.getContext('2d');ctx.clearRect(0,0,c.width,c.height);
      try{const r=await fetch('https://sql.axxa.dev/history.json',{cache:'no-store'});const h=await r.json();const pts=(h.points||[]).slice(-180);if(!pts.length){ctx.fillStyle='#b6c7ef';ctx.fillText('No history yet',12,24);return;}
      const map={healthy:2,degraded:1,danger:0},colors={healthy:'#22c55e',degraded:'#f59e0b',danger:'#ef4444'},w=c.width,hg=c.height,p=20;
      ctx.strokeStyle='#1d4ed8';ctx.lineWidth=1;for(let i=0;i<3;i++){const y=p+((hg-2*p)/2)*i;ctx.beginPath();ctx.moveTo(p,y);ctx.lineTo(w-p,y);ctx.stroke();}
      for(let i=1;i<pts.length;i++){const p0=pts[i-1],p1=pts[i],x0=p+((w-2*p)*(i-1)/(pts.length-1)),x1=p+((w-2*p)*i/(pts.length-1)),y0=p+((hg-2*p)*(2-(map[p0.overall]??1))/2),y1=p+((hg-2*p)*(2-(map[p1.overall]??1))/2);ctx.strokeStyle=colors[p1.overall]||'#f59e0b';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(x0,y0);ctx.lineTo(x1,y1);ctx.stroke();}
      }catch(e){ctx.fillStyle='#ef4444';ctx.fillText('Failed to load history',12,24);}
    }
    const sourceLink=document.getElementById('sourceLink');if(sourceLink){sourceLink.addEventListener('click',function(e){const selected=window.getSelection?window.getSelection().toString():'';if(selected&&selected.length>0){e.preventDefault();}})}
    load();drawHistory();setInterval(load,10000);setInterval(drawHistory,10000);
  </script>
</body>
</html>
